<html>

	<head>
	    <meta charset="utf-8">
	    <title>
	    	 Lucene简介和入门 -  Laravel 知识整理
	    </title>
	    <meta name="description" content=" (Fanshine)">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="/theme/styles/styles.css">
		<link rel="stylesheet" href="/theme/styles/pygments.css">
		<link rel="stylesheet" href="/theme/styles/my.css">

		<script type="text/javascript" src="/js/jquery/jquery-1.8.0.min.js"></script>
		<script type="text/javascript">
			$(function(){

			});
		</script>

	</head>

	<body>
		<div id="wrapper">

			<div id="header">
				<ul id="extras-nav">
					<li><a href="/">博客</a></li>
					<li><a href="/archives.html">存档</a></li>
					<li><a href="/about.html">关于</a></li>
					<li><a href="/atom.xml" target="_blank" rel="nofollow">RSS</a></li>
				</ul>
				<h1><a id="title" href="/">Laravel 知识整理</a></h1>
			</div>


			<script type="text/javascript">
	$(document).ready(function(){
		$("#comments_trigger").toggle(
			function(){
				$("#comments_list").show();
				$("#comments_trigger").html("<b>隐藏评论</b>");
			},
			function(){
				$("#comments_list").hide();
				$("#comments_trigger").html("<b>显示评论</b>");
			}
		);
	});
</script>

<div id="content">
	<div class="text-post posts">

		<h2>Lucene简介和入门</h2>

		<div class="caption rich-content">

			<p>这几天我花了些时间去研究了下Lucene，读了很多博客和文章，也写了些示例代码，对全文检索以及使用到的技术都有了认识，感觉非常好。<br/>
Lucene是当今非常流行的全文检索工具，对于我们开发者来说，给应用添加一个搜索功能确实容易很多了，希望在接下来的项目里可以一施拳脚。<br/>
接下来对Lucene进行一个初步的介绍，并附带一个简单的示例程序。</p>

<h3>Lucene 简介</h3>

<p>Lucene是一个基于Java的高性能、可伸缩的全文信息检索库，它提供了简单而强大的API，让你很容易为文档创建索引，并基于创建的索引进行搜索。<br/>
Lucene是由资深全文索引/检索专家Doug Cutting创建的，开始是给自己的博客程序使用，后来开源出来，如今它已成为Apache软件基金会的顶级项目，也成为最受欢迎的Java全文信息检索工具。</p>

<h3>Lucene 原理</h3>

<p>Lucene主要完成两件事：</p>

<ol>
<li>创建索引</li>
<li>基于索引搜索。</li>
</ol>


<p>创建搜索是一件非常关键的一步，Lucene 采用的是一种称为反向索引（inverted index）的机制。
先说下什么是正向索引（若是有这个概念的话），给你一些文档，让你找到里面的词/短语，类似小学课堂上，老说问：“同学们，有谁来总结下这篇文章讲了什么？”，这是一个从文档到词/短语的过程。<br/>
而反向索引刚好相反，它是指从词/短语到文档的过程，举一个例子：给出“Java”这个关键字，找到所有Java相关的文档。</p>

<p>当索引创建已经创建好之后，搜索文档就是先到索引库里去找索引，然后根据找到的索引找到文档。整个过程可以用下图表示：
<img src="http://fanshine.github.io/laravelLearningBlog//uploads/2012-10-19/lucene.png" alt="Lucene典型应用结构图" /></p>

<h3>入门示例</h3>

<p><strong>创建索引</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">docsDir</span> <span class="o">=</span> <span class="s">&quot;src&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">indexDir</span> <span class="o">=</span> <span class="s">&quot;target/index&quot;</span><span class="o">;</span>
        <span class="n">Directory</span> <span class="n">directory</span> <span class="o">=</span> <span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">indexDir</span><span class="o">));</span>
        <span class="n">Analyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StandardAnalyzer</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_40</span><span class="o">);</span>
        <span class="n">IndexWriterConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">IndexWriterConfig</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_40</span><span class="o">,</span> <span class="n">analyzer</span><span class="o">);</span>
        <span class="n">IndexWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">IndexWriter</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>
        <span class="n">indexDocs</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">docsDir</span><span class="o">));</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">indexDocs</span><span class="o">(</span><span class="n">IndexWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="n">File</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">File</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="na">listFiles</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">files</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">files</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">indexDocs</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="n">files</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Document</span><span class="o">();</span>
        <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">StringField</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="n">path</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">YES</span><span class="o">));</span>
        <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">StringField</span><span class="o">(</span><span class="s">&quot;path&quot;</span><span class="o">,</span> <span class="n">path</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">YES</span><span class="o">));</span>
        <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">TextField</span><span class="o">(</span><span class="s">&quot;contents&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">)));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;adding &quot;</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">addDocument</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>


<p><strong>基于索引搜索</strong></p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">search</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&quot;target/index&quot;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">searchField</span> <span class="o">=</span> <span class="s">&quot;contents&quot;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">keyWorld</span> <span class="o">=</span> <span class="s">&quot;String&quot;</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">IndexReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">DirectoryReader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">index</span><span class="o">)));</span>
        <span class="n">IndexSearcher</span> <span class="n">searcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">IndexSearcher</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
        <span class="n">Analyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StandardAnalyzer</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_40</span><span class="o">);</span>
        <span class="n">QueryParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">QueryParser</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_40</span><span class="o">,</span> <span class="n">searchField</span><span class="o">,</span> <span class="n">analyzer</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">keyWorld</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Search [&quot;</span> <span class="o">+</span> <span class="n">keyWorld</span> <span class="o">+</span> <span class="s">&quot;]:&quot;</span><span class="o">);</span>
        <span class="n">TopDocs</span> <span class="n">results</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
        <span class="n">ScoreDoc</span><span class="o">[]</span> <span class="n">hits</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">scoreDocs</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hits</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">doc</span><span class="o">(</span><span class="n">hits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">doc</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>


<p>项目基于Maven，完整源码请点击下载：<a href="http://fanshine.github.io/laravelLearningBlog//uploads/2012-10-19/lucene.zip" title="lucene.zip">lucene.zip</a></p>


		</div>

		<div class="meta">
			<p> ∞ 发布日期：2012-10-19 </p>
			<p> ∞ 发布目录：hello </p>
			<p> ∞ 发布标签：HelloWorld, Lucene</p>
			<p> ∞ 永久连接：http://fanshine.github.io/laravelLearningBlog//2012-10-19/hello-lucene.html </p>
		</div>

		<div class="comments">
			<a id="comments_trigger" href="#comments" onclick="show_comments()"><b>显示评论</b></a>
			<div id="comments_list" style="display: none;">
				<hr/>
				<div id="bm_comments"></div>
				<script type="text/javascript">
					(function(){
					var script = document.createElement('script'); script.type = "text/javascript";
						script.src = "http://baye.me/script?key=f5ef00e2aa7c11e1b86412314303b429";
						(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
					})();
				</script>
			</div>
		</div>

	</div>
</div>



			<div id="footer">

				<div class="tag-search" style="display: none;">
					<form id="tag-form" action="/tag" method="get">
						<div class="search-text-wrapper">
							<input type="hidden" name="search" value="1">
							<input id="search-text" autocomplete="off" name="tag" class="search-text" type="text" value="">
							<label id="search-tip" style="display: block; ">搜索</label>
							<input id="search-btn" class="search-button" type="button" value="搜索">
						</div>
					</form>
				</div>

				<p>© 2012 Laravel 知识整理</p>
				<p>Powered by <a href="http://www.github.com" target="_blank">Github</a> and <a href="https://github.com/mojombo/jekyll" target="_blank">Jekyll</a> .</p>

			</div>
		</div>

	</body>
</html>