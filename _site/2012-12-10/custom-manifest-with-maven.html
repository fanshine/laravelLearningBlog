<html>

	<head>
	    <meta charset="utf-8">
	    <title>
	    	 使用Maven定制MANIFEST.MF文件 -  Laravel 知识整理
	    </title>
	    <meta name="description" content=" (Fanshine)">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="/theme/styles/styles.css">
		<link rel="stylesheet" href="/theme/styles/pygments.css">
		<link rel="stylesheet" href="/theme/styles/my.css">

		<script type="text/javascript" src="/js/jquery/jquery-1.8.0.min.js"></script>
		<script type="text/javascript">
			$(function(){

			});
		</script>

	</head>

	<body>
		<div id="wrapper">

			<div id="header">
				<ul id="extras-nav">
					<li><a href="/">博客</a></li>
					<li><a href="/archives.html">存档</a></li>
					<li><a href="/about.html">关于</a></li>
					<li><a href="/atom.xml" target="_blank" rel="nofollow">RSS</a></li>
				</ul>
				<h1><a id="title" href="/">Laravel 知识整理</a></h1>
			</div>


			<script type="text/javascript">
	$(document).ready(function(){
		$("#comments_trigger").toggle(
			function(){
				$("#comments_list").show();
				$("#comments_trigger").html("<b>隐藏评论</b>");
			},
			function(){
				$("#comments_list").hide();
				$("#comments_trigger").html("<b>显示评论</b>");
			}
		);
	});
</script>

<div id="content">
	<div class="text-post posts">

		<h2>使用Maven定制MANIFEST.MF文件</h2>

		<div class="caption rich-content">

			<p>对于Java开发者来说，对MANIFEST.MF文件应该不陌生，至少有所耳闻。我们打开任何一个jar包，都会看到一个METE-INF目录，该目录下必然有一个MANIFEST.MF文件，这个文件是用来描述当前jar文件的信息。</p>

<p>举个例子，下面是我们常使用的c3p0-0.9.1.2.jar文件里的MANIFEST.MF内容：</p>

<blockquote><p>Manifest-Version: 1.0<br/>
  Ant-Version: Apache Ant 1.7.0<br/>
  Created-By: 1.5.0_07-87 ("Apple Computer, Inc.")<br/>
  Extension-Name: com.mchange.v2.c3p0<br/>
  Specification-Vendor: Machinery For Change, Inc.<br/>
  Specification-Version: 1.0<br/>
  Implementation-Vendor-Id: com.mchange<br/>
  Implementation-Vendor: Machinery For Change, Inc.<br/>
  Implementation-Version: 0.9.1.2</p></blockquote>

<p>它看起来简单明了，我就不多解释了。当然，不同的jar包里的内容可能完全不同，比如说Springframwork的那些jar文件，内容不但多了许多，而且名称也都变得不同。</p>

<p>我曾经参与的一个Web项目中，有一个需求是在页面某个位置显示代码构建的时间，看起来差不多是这样的：</p>

<blockquote><p>Build At: 2012-12-10 23:54:22</p></blockquote>

<p>（当时的情况还要求显示代码的版本号，具体做法本文先略过。）</p>

<p>当时就是采用定制MANIFEST.MF（加入构建时间戳），并用程序读取该时间戳实现的！
接下来就结合该需求说说在使用Maven构建的项目中，如何为MANIFEST.MF增加自定义内容，并完成该功能。</p>

<ol>
<li><p>首先，在pom.xml文件中增加属性：</p>

<blockquote><p>&lt;properties&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;maven.build.timestamp.format>yyyy-MM-dd HH:mm:ss&lt;/maven.build.timestamp.format&gt;<br/>
&lt;/properties&gt;</p></blockquote></li>
<li><p>接下来配置maven-war-plugin插件，在configuration里增加archive节点，配置如下：</p>

<blockquote><p>&lt;plugin&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.1.1&lt;/version&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;archive&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;manifest&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;addDefaultSpecificationEntries&gt;true&lt;/addDefaultSpecificationEntries&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/manifest&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;manifestEntries&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Built-At&gt;${maven.build.timestamp}&lt;/Built-At&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/manifestEntries&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/archive&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br/>
&lt;/plugin&gt;</p></blockquote></li>
<li><p>这样，当你再次打包工程时，新打包的文件里的MANIFEST.MF就会包含构建时间，如图：<br/>
<img src="../uploads/2012-12-10/manifest.mf.png" alt="MANIFEST.MF" /><br/>
PS：你还可以增加更多内容，只需要在manifestEntries节点中增加key-value值就OK啦。</p></li>
<li><p>最后一步：你需要写一小段代码来获取该构件时间，把它显示在你的页面上。<br/>
或许你已经知道大名鼎鼎的框架Springframework获取版本号的代码是这样的(详见<a href="https://github.com/SpringSource/spring-framework/blob/3.1.x/org.springframework.core/src/main/java/org/springframework/core/SpringVersion.java">SpringVersion.java</a>)：</p></li>
</ol>


<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getVersion</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Package</span> <span class="n">pkg</span> <span class="o">=</span> <span class="n">SpringVersion</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">();</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">pkg</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">pkg</span><span class="o">.</span><span class="na">getImplementationVersion</span><span class="o">()</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>


<p>但很遗憾这种方式在Web项目中不起作用。因为为Web应用编写的Java代码，会编译为class文件并放在$WEBROOT/WEB-INF/classes目录下，而war包的MANIFEST.MF文件位于$WEBROOT/META-INF目录下，它们不在同一个“包”下。事实上，Package类根本没有提供任何获取自定义值的方法（哈哈哈），详见<a href="http://www.oschina.net/uploads/doc/javase-6-doc-api-zh_CN/java/lang/Package.html">Package.html</a>。<br/>
所以 --- 是时候自己动手了。</p>


		</div>

		<div class="meta">
			<p> ∞ 发布日期：2012-12-10 </p>
			<p> ∞ 发布目录：work </p>
			<p> ∞ 发布标签：Maven, Manifest</p>
			<p> ∞ 永久连接：http://fanshine.github.io/laravelLearningBlog//2012-12-10/custom-manifest-with-maven.html </p>
		</div>

		<div class="comments">
			<a id="comments_trigger" href="#comments" onclick="show_comments()"><b>显示评论</b></a>
			<div id="comments_list" style="display: none;">
				<hr/>
				<div id="bm_comments"></div>
				<script type="text/javascript">
					(function(){
					var script = document.createElement('script'); script.type = "text/javascript";
						script.src = "http://baye.me/script?key=f5ef00e2aa7c11e1b86412314303b429";
						(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
					})();
				</script>
			</div>
		</div>

	</div>
</div>



			<div id="footer">

				<div class="tag-search" style="display: none;">
					<form id="tag-form" action="/tag" method="get">
						<div class="search-text-wrapper">
							<input type="hidden" name="search" value="1">
							<input id="search-text" autocomplete="off" name="tag" class="search-text" type="text" value="">
							<label id="search-tip" style="display: block; ">搜索</label>
							<input id="search-btn" class="search-button" type="button" value="搜索">
						</div>
					</form>
				</div>

				<p>© 2012 Laravel 知识整理</p>
				<p>Powered by <a href="http://www.github.com" target="_blank">Github</a> and <a href="https://github.com/mojombo/jekyll" target="_blank">Jekyll</a> .</p>

			</div>
		</div>

	</body>
</html>